
# âš™ï¸ Middleware in Next.js 13+: Power at the Edge

## ğŸ§­ Introduction

With **Next.js 13+**, Middleware has become a powerful tool to run logic **before a request reaches your route or API handler** â€” all at the **Edge**, close to your users. It's ideal for authentication, redirects, geolocation-based content, logging, A/B testing, and more â€” without slowing down your app.

---

## ğŸšª What is Middleware?

**Middleware** in Next.js is a special function that executes **before a request is completed**, allowing you to modify the request or response, redirect, rewrite, or block access â€” **without touching your routes**.

It runs on the **Edge Runtime**, which is faster and more scalable than traditional Node.js backends.

---

## ğŸ—ï¸ How It Works

You define middleware in a special file:

```
/middleware.ts (or .js)
```

It applies to all routes unless scoped via `matcher`.

---

### ğŸ”§ Basic Example

```ts
// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  const url = request.nextUrl.clone();

  // Example: Redirect users from /admin if not authenticated
  const isLoggedIn = request.cookies.get('token');

  if (!isLoggedIn && url.pathname.startsWith('/admin')) {
    url.pathname = '/login';
    return NextResponse.redirect(url);
  }

  return NextResponse.next(); // continue normally
}
```

---

## ğŸŒ Middleware Routing Scope (matcher)

You can control which routes use middleware with the `matcher` key in `middleware.config.js` or inside `export const config`.

```ts
export const config = {
  matcher: ['/dashboard/:path*', '/admin/:path*'],
};
```

âœ… More efficient  
âœ… Prevents unnecessary middleware on public/static pages

---

## ğŸ’¡ Use Cases

| Use Case                   | Example Description                                     |
|----------------------------|----------------------------------------------------------|
| ğŸ” Authentication Gate     | Redirect unauthenticated users away from protected pages |
| ğŸŒ Geo-Based Redirection   | Redirect users to `/fr` or `/en` based on country         |
| ğŸ§ª A/B Testing             | Serve different variants for experimentation             |
| ğŸ¯ URL Rewriting          | Rewrite routes like `/blog/post-name` to `/api/post?slug=post-name` |
| ğŸ“Š Logging & Analytics     | Log user agent, IP, or request headers                   |

---

## âš ï¸ Limitations

- No access to `req.body` (streams not supported in Edge)
- No support for Node.js native modules (only Edge-compatible code)
- Must be defined at the **root level** of your project
- Cannot use dynamic server-side code (e.g., DB queries)

---

## âš¡ Performance Benefit

Middleware runs on the **V8-based Edge Runtime** â€” closer to users, with:
- Ultra-low latency
- Cold start < 1ms
- Globally distributed execution

---

## ğŸ” Comparison: Middleware vs API Route Middleware

| Feature                  | Next.js Middleware           | API Route Middleware (`req/res`)  |
|--------------------------|------------------------------|-----------------------------------|
| Runs Before Route Match  | âœ… Yes                        | âŒ No                              |
| Runs on Edge             | âœ… Yes (Edge Runtime)         | âŒ No (Node.js)                    |
| Access to req.body       | âŒ No                         | âœ… Yes                             |
| Redirects / Rewrites     | âœ… Yes                        | âŒ No (must handle in logic)       |

---

## ğŸ§  Best Practices

- âœ… Use it for **routing logic**, not business logic
- âœ… Keep it **lightweight and fast**
- âŒ Avoid complex DB queries or heavy computation
- âœ… Use `matcher` to limit to necessary paths
- âœ… Leverage it for **security, UX, and performance**

---

## ğŸ“ Example Project Structure

```
/pages
  /login.tsx
  /admin.tsx
/middleware.ts
```

With this:

```ts
export const config = {
  matcher: ['/admin/:path*'],
};
```

You can restrict `/admin` access globally.

---

## âœ… Summary

**Next.js Middleware (13+)** brings routing logic to the edge â€” enabling secure, fast, and user-aware requests. Itâ€™s a critical part of building scalable web apps with modern user experiences.

> Think of Middleware as the gatekeeper between your user and your app â€” fast, global, and powerful.

